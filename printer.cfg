#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
### Everything below [include RatOS.cfg] will override default RatOS behavior
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[ratos]
allow_unsupported_slicer_versions: True

[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"

#### HOMING ####
[gcode_macro RatOS]
variable_homing: "sensorless"                    # endstops|sensorless = axis homing method
variable_z_probe: "static"                     # static|stowable = z-probe type
variable_home_y_first: True
variable_safe_home_x: "middle"                 # float|middle = z-homing x location
variable_safe_home_y: "middle"                 # float|middle = z-homing y location
variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 1.4            # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 1.4            # float = stepper driver run current for sensorless y-homing

#### MESH ####
[gcode_macro RatOS]
variable_calibrate_bed_mesh: True                # True|False = enable bed meshing
variable_adaptive_mesh: True                     # True|False = enable adaptive bed meshing
variable_adaptive_prime_offset_threshold: -1.0   # float = threshold value used for probing sanity checks
variable_beacon_scan_compensation_enable: False


#### CHAMBER HEATING ####
[gcode_macro RatOS]
variable_chamber_heater_enable: True                      # True|False = enable chamber heater control
variable_chamber_heater_bed_temp: 115                     # int = bed temperature during chamber preheating
variable_chamber_heater_preheating_temp: 150              # int = the temp the generic_heater is set to when preheating the chamber
variable_chamber_heater_heating_temp_offset: 25           # int = the temp offset for the generic_heater, in addition to the target chamber_temp, while printing
variable_chamber_heater_control_external_heater: False    # True|False = automatic heater control for external heater devices
variable_chamber_heater_air_circulation_enable: True      # True|False = uses the part cooling to blow air from the top of the chamber to the bottom when preheating the chamber
variable_chamber_heater_air_circulation_fan_speed: 0.80   # float = the part cooling fan speed that is used to circulate the air when preheating the chamber
variable_chamber_heater_air_circulation_y_pos: 90         # float = toolhead y-pos when circulating the air
variable_chamber_heater_air_circulation_z_pos: 25         # float = toolhead z-pos when circulating the air
variable_chamber_heater_extra_fan_speed: 1.0              # float = the extra chamber heater fan that is used to circulate the air when preheating the chamber

#### CHAMBER FILTER ####
[gcode_macro RatOS]
variable_chamber_filter_enable: True                     # True|False = enable chamber filter control
variable_chamber_filter_speed: 1.0                       # float = chamber filter fan speed.
variable_chamber_filter_enable_at: "before_print_start"   # before_print_start|after_print_start|print_end = when to enable the filter
variable_chamber_filter_disable_period: 600              # int = disable fan after X seconds after the print ends
variable_chamber_filter_disable_bed_temp: 0              # int = wait for XÂ°C bed temp after the print ends before disabling the filter

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

[extruder]
nozzle_diameter: 0.5
dir_pin: !PC1
#control: pid
#pid_kp = 16.929
#pid_ki = 0.795
#pid_kd = 90.154

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[resonance_tester]
#accel_chip_x: adxl345 toolboard_t0
#accel_chip_y: adxl345 toolboard_t0
accel_chip_x: beacon
accel_chip_y: beacon
accel_per_hz: 100
sweeping_accel: 400
sweeping_period: 0

[include /home/pi/printer_data/config/custom/tuning/*]
[include /home/pi/printer_data/config/custom/octopus-pro-11.cfg]

[include /home/pi/printer_data/config/custom/k3/k3.cfg]

[include /home/pi/printer_data/config/custom/extruders/sherpa_mini-8t.cfg]
[include /home/pi/printer_data/config/custom/hotends/tk.cfg]

[include /home/pi/printer_data/config/custom/probes/beacon.cfg]

[include /home/pi/printer_data/config/custom/fans/*]
[include /home/pi/printer_data/config/custom/sensors/*]

[include /home/pi/printer_data/config/custom/macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 44.147
#*# pid_ki = 2.317
#*# pid_kd = 210.250
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 19.810
#*# pid_ki = 0.905
#*# pid_kd = 108.460
#*#
#*# [beacon model default]
#*# model_coef = 1.5397958580107056,
#*# 	1.8722036876842814,
#*# 	0.7889292195157752,
#*# 	0.4540799703973667,
#*# 	0.32153310994272705,
#*# 	-0.031233267998835672,
#*# 	-0.27597812470941413,
#*# 	0.09366807635029115,
#*# 	0.22635426192798153,
#*# 	0.01343114009076899
#*# model_domain = 1.864419297996723e-07,1.938628263045366e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.393495
#*# model_offset = 0.00000
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  -0.058590, -0.054078, -0.048827, -0.045412, -0.042161, -0.040626, -0.039580, -0.039489, -0.036308, -0.034696, -0.035066, -0.034179, -0.035586, -0.037852, -0.039769, -0.042968, -0.044496, -0.045617, -0.047428, -0.048523, -0.050082, -0.050610, -0.055588
#*# 	  -0.051826, -0.045812, -0.040583, -0.037332, -0.035606, -0.034040, -0.031412, -0.031033, -0.028769, -0.027249, -0.026110, -0.025551, -0.026436, -0.029840, -0.032059, -0.036682, -0.036357, -0.039231, -0.039049, -0.042759, -0.044318, -0.045936, -0.047591
#*# 	  -0.050190, -0.044944, -0.038725, -0.034824, -0.032337, -0.031252, -0.029043, -0.028120, -0.025362, -0.023279, -0.021920, -0.020274, -0.021281, -0.023986, -0.027432, -0.031201, -0.032849, -0.034766, -0.034271, -0.035399, -0.037267, -0.041549, -0.043426
#*# 	  -0.040648, -0.033439, -0.028653, -0.024273, -0.021387, -0.019169, -0.018495, -0.017092, -0.015358, -0.013768, -0.010559, -0.010809, -0.012988, -0.015760, -0.018440, -0.021845, -0.022574, -0.024024, -0.026425, -0.029969, -0.032896, -0.033368, -0.034627
#*# 	  -0.041335, -0.034919, -0.029447, -0.025590, -0.020443, -0.019681, -0.017640, -0.017329, -0.012914, -0.011352, -0.008887, -0.008079, -0.007722, -0.011470, -0.015418, -0.018315, -0.019079, -0.020452, -0.022025, -0.024832, -0.029373, -0.030916, -0.031859
#*# 	  -0.036415, -0.028513, -0.023830, -0.018565, -0.015113, -0.013394, -0.011031, -0.009654, -0.007078, -0.004695, -0.003705, -0.002277, -0.004013, -0.008850, -0.011201, -0.013817, -0.013749, -0.016873, -0.019356, -0.021208, -0.025234, -0.027664, -0.028994
#*# 	  -0.037544, -0.030610, -0.026298, -0.021690, -0.018643, -0.015088, -0.012898, -0.009789, -0.007689, -0.005688, -0.002128, -0.000771, -0.001563, -0.004355, -0.008061, -0.010312, -0.010205, -0.012945, -0.014930, -0.018040, -0.023362, -0.023505, -0.025454
#*# 	  -0.031681, -0.023936, -0.018847, -0.015383, -0.011366, -0.008066, -0.005422, -0.003358, -0.000642, 0.002541, 0.004336, 0.007268, 0.004688, 0.002925, -0.000299, -0.003182, -0.004626, -0.007430, -0.010751, -0.013892, -0.017022, -0.019132, -0.020565
#*# 	  -0.034245, -0.029113, -0.024997, -0.020885, -0.016297, -0.013567, -0.011098, -0.007806, -0.004217, -0.002396, 0.000578, 0.003454, 0.004459, 0.000211, -0.003933, -0.005603, -0.006703, -0.008075, -0.012454, -0.015369, -0.018936, -0.021140, -0.021788
#*# 	  -0.030983, -0.024034, -0.019658, -0.014701, -0.011737, -0.008005, -0.005412, -0.004173, -0.000973, 0.002134, 0.005346, 0.008927, 0.008176, 0.005436, 0.001957, -0.002096, -0.003342, -0.005593, -0.009327, -0.012413, -0.016106, -0.017361, -0.018312
#*# 	  -0.035453, -0.030690, -0.025374, -0.020182, -0.017942, -0.015551, -0.011861, -0.009725, -0.006486, -0.003088, -0.000116, 0.002915, 0.005131, 0.001893, -0.002235, -0.004918, -0.006121, -0.008316, -0.011442, -0.015022, -0.017311, -0.019112, -0.020038
#*# 	  -0.030939, -0.024490, -0.020337, -0.015156, -0.011425, -0.009396, -0.006401, -0.005731, -0.001556, 0.000783, 0.004316, 0.008077, 0.008122, 0.005448, 0.002942, -0.000480, -0.001349, -0.003465, -0.006904, -0.011206, -0.012942, -0.014329, -0.015318
#*# 	  -0.037891, -0.031362, -0.026585, -0.022028, -0.019010, -0.017230, -0.014205, -0.012355, -0.008347, -0.007358, -0.003284, 0.001069, 0.001996, 0.000163, -0.003854, -0.005056, -0.006030, -0.007748, -0.010287, -0.013113, -0.015573, -0.018171, -0.018697
#*# 	  -0.036799, -0.029372, -0.024370, -0.019566, -0.016989, -0.015619, -0.011343, -0.009825, -0.006512, -0.002746, -0.001865, 0.001865, 0.001825, 0.000539, -0.003198, -0.004655, -0.005744, -0.005996, -0.010335, -0.014883, -0.016195, -0.016726, -0.017615
#*# 	  -0.045722, -0.038877, -0.033517, -0.028962, -0.026660, -0.022608, -0.019422, -0.017675, -0.015731, -0.011842, -0.008807, -0.007044, -0.006324, -0.007367, -0.012228, -0.013519, -0.012806, -0.013106, -0.014351, -0.018166, -0.020017, -0.021872, -0.022705
#*# 	  -0.046855, -0.039513, -0.031931, -0.025742, -0.023254, -0.021166, -0.014909, -0.011925, -0.006685, -0.004981, -0.006068, -0.004245, -0.003546, -0.006877, -0.010470, -0.010639, -0.010225, -0.011116, -0.013927, -0.017510, -0.019845, -0.021570, -0.020354
#*# 	  -0.060063, -0.053572, -0.045139, -0.039407, -0.033775, -0.026865, -0.022591, -0.022559, -0.020147, -0.017481, -0.015923, -0.013656, -0.010162, -0.011479, -0.019649, -0.020493, -0.020444, -0.020064, -0.022068, -0.025041, -0.027849, -0.027992, -0.028698
#*# 	  -0.062801, -0.054671, -0.047131, -0.039909, -0.036506, -0.028139, -0.024841, -0.023218, -0.018599, -0.010621, -0.010602, -0.015753, -0.016858, -0.018981, -0.018909, -0.015093, -0.017396, -0.019479, -0.023822, -0.027860, -0.031081, -0.030904, -0.030284
#*# x_count = 23
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 34.49
#*# max_x = 140.0
#*# min_y = 47.5761
#*# max_y = 129.424
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 90.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 89.6
