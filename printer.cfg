#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
### Everything below [include RatOS.cfg] will override default RatOS behavior
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[ratos]
allow_unsupported_slicer_versions: True

[gcode_macro RatOS]
variable_relative_extrusion: True
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"

#### HOMING ####
[gcode_macro RatOS]
variable_homing: "sensorless"                    # endstops|sensorless = axis homing method
variable_z_probe: "static"                     # static|stowable = z-probe type
variable_home_y_first: True
variable_safe_home_x: "middle"                 # float|middle = z-homing x location
variable_safe_home_y: "middle"                 # float|middle = z-homing y location
variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 1.4            # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 1.4            # float = stepper driver run current for sensorless y-homing

#### MESH ####
[gcode_macro RatOS]
variable_calibrate_bed_mesh: True                # True|False = enable bed meshing
variable_adaptive_mesh: True                     # True|False = enable adaptive bed meshing
variable_adaptive_prime_offset_threshold: -1.0   # float = threshold value used for probing sanity checks
variable_beacon_scan_compensation_enable: False


#### CHAMBER HEATING ####
[gcode_macro RatOS]
variable_chamber_heater_enable: True                      # True|False = enable chamber heater control
variable_chamber_heater_bed_temp: 115                     # int = bed temperature during chamber preheating
variable_chamber_heater_preheating_temp: 150              # int = the temp the generic_heater is set to when preheating the chamber
variable_chamber_heater_heating_temp_offset: 25           # int = the temp offset for the generic_heater, in addition to the target chamber_temp, while printing
variable_chamber_heater_control_external_heater: False    # True|False = automatic heater control for external heater devices
variable_chamber_heater_air_circulation_enable: True      # True|False = uses the part cooling to blow air from the top of the chamber to the bottom when preheating the chamber
variable_chamber_heater_air_circulation_fan_speed: 0.80   # float = the part cooling fan speed that is used to circulate the air when preheating the chamber
variable_chamber_heater_air_circulation_y_pos: 90         # float = toolhead y-pos when circulating the air
variable_chamber_heater_air_circulation_z_pos: 25         # float = toolhead z-pos when circulating the air
variable_chamber_heater_extra_fan_speed: 1.0              # float = the extra chamber heater fan that is used to circulate the air when preheating the chamber

#### CHAMBER FILTER ####
[gcode_macro RatOS]
variable_chamber_filter_enable: True                     # True|False = enable chamber filter control
variable_chamber_filter_speed: 1.0                       # float = chamber filter fan speed.
variable_chamber_filter_enable_at: "before_print_start"   # before_print_start|after_print_start|print_end = when to enable the filter
variable_chamber_filter_disable_period: 600              # int = disable fan after X seconds after the print ends
variable_chamber_filter_disable_bed_temp: 0              # int = wait for XÂ°C bed temp after the print ends before disabling the filter

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

[extruder]
nozzle_diameter: 0.5
dir_pin: !PC1
#control: pid
#pid_kp = 16.929
#pid_ki = 0.795
#pid_kd = 90.154

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[resonance_tester]
#accel_chip_x: adxl345 toolboard_t0
#accel_chip_y: adxl345 toolboard_t0
accel_chip_x: beacon
accel_chip_y: beacon
accel_per_hz: 100
sweeping_accel: 400
sweeping_period: 0

[include /home/pi/printer_data/config/custom/tuning/*]
[include /home/pi/printer_data/config/custom/octopus-pro-11.cfg]

[include /home/pi/printer_data/config/custom/k3/k3.cfg]

[include /home/pi/printer_data/config/custom/extruders/sherpa_mini-8t.cfg]
[include /home/pi/printer_data/config/custom/hotends/tk.cfg]

[include /home/pi/printer_data/config/custom/probes/beacon.cfg]

[include /home/pi/printer_data/config/custom/fans/*]
[include /home/pi/printer_data/config/custom/sensors/*]

[include /home/pi/printer_data/config/custom/macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 44.147
#*# pid_ki = 2.317
#*# pid_kd = 210.250
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 19.810
#*# pid_ki = 0.905
#*# pid_kd = 108.460
#*#
#*# [beacon model default]
#*# model_coef = 1.5397958580107056,
#*# 	  1.8722036876842814,
#*# 	  0.7889292195157752,
#*# 	  0.4540799703973667,
#*# 	  0.32153310994272705,
#*# 	  -0.031233267998835672,
#*# 	  -0.27597812470941413,
#*# 	  0.09366807635029115,
#*# 	  0.22635426192798153,
#*# 	  0.01343114009076899
#*# model_domain = 1.864419297996723e-07,1.938628263045366e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.393495
#*# model_offset = 0.00000
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	-0.233870, -0.237045, -0.240249, -0.241750, -0.248220, -0.259402
#*# 	-0.228398, -0.229757, -0.234214, -0.240645, -0.246204, -0.253593
#*# 	-0.230531, -0.232038, -0.236461, -0.240337, -0.246165, -0.254059
#*# 	-0.227998, -0.230677, -0.233080, -0.237709, -0.245030, -0.252210
#*# 	-0.229682, -0.233949, -0.236941, -0.240475, -0.246311, -0.252697
#*# 	-0.228710, -0.233187, -0.233950, -0.238231, -0.243399, -0.252639
#*# x_count = 6
#*# y_count = 6
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 76.0
#*# max_x = 104.0
#*# min_y = 76.0
#*# max_y = 104.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 91.2
#*# shaper_type_y = mzv
#*# shaper_freq_y = 89.8
